- name: Addtional actions for kubernetes cluster
  hosts: k8s_cluster
  tasks:
    - name: Blank filesystem signature on /dev/disk/by-id/{{ kube_disk_device_name }}
      community.general.filesystem:
        dev: "/dev/disk/by-id/{{ kube_disk_device_name }}"
        fstype: ext4
        force: true
        state: present

    - name: Mount network disks on /mnt/network-ssd-nonreplicated
      ansible.posix.mount:
        path: /mnt/network-ssd-nonreplicated
        src: "/dev/disk/by-id/{{ kube_disk_device_name }}"
        fstype: ext4
        state: present

    - name: Add entry for prometheus server
      ansible.builtin.lineinfile:
        dest: /etc/hosts
        line: "{{ hostvars[groups.kube_control_plane[0]].ansible_host }} prometheus.stropy.io"
        state: present

    - name: Add entry for ydb monitoring panel
      ansible.builtin.lineinfile:
        dest: /etc/hosts
        line: "{{ hostvars[groups.kube_node[0]].ansible_host }} stroppy-ydb-storage.stropy.io"
        state: present
